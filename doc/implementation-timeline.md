# 实现计划与时间表

## 1. 项目总体时间规划

**项目周期**：12-16 周  
**开发模式**：迭代开发 (Sprint-based)  
**每个 Sprint**：2 周

---

## 2. Phase 划分

### Phase 1：基础框架 (第 1-2 周)

#### 任务清单

1. **项目初始化**
   - [ ] 创建项目目录结构
   - [ ] 配置 Python 环境 (requirements.txt, setup.py)
   - [ ] 配置 Git 仓库
   - [ ] 配置 CI/CD (可选)
   - **预计时间**：1-2 天

2. **PyQt5 应用框架**
   - [ ] 创建主窗口 (`MainWindow`)
   - [ ] 搭建菜单栏和工具栏
   - [ ] 创建状态栏
   - [ ] 设置样式表 (QSS)
   - **预计时间**：3 天

3. **配置管理**
   - [ ] 编写 YAML 配置解析器
   - [ ] 创建 config.yaml、paths.yaml、hyperparams.yaml
   - [ ] 实现配置热加载
   - **预计时间**：1-2 天

4. **日志系统**
   - [ ] 配置日志系统 (`logger.py`)
   - [ ] 实现 LogViewer Widget
   - [ ] 集成文件和 GUI 日志输出
   - **预计时间**：1 天

5. **基础工具函数**
   - [ ] 文件 I/O 工具 (`file_utils.py`)
   - [ ] 图片处理工具 (`image_utils.py`)
   - [ ] Mask 处理工具 (`mask_utils.py`)
   - **预计时间**：2-3 天

---

### Phase 2：数据管理模块 (第 3-4 周)

#### 任务清单

1. **数据管理器** (`DataManager`)
   - [ ] 实现图片加载 (`load_image`)
   - [ ] 实现视频处理 (`load_video`)
   - [ ] 实现文件夹批量加载
   - [ ] 实现图片缓存管理
   - [ ] 实现数据集结构创建
   - **预计时间**：3-4 天

2. **文件浏览器 Widget** (`FileBrowser`)
   - [ ] 创建文件列表视图
   - [ ] 实现文件夹导航
   - [ ] 实现文件过滤 (支持的格式)
   - [ ] 实现搜索功能
   - **预计时间**：2-3 天

3. **图片编辑画布** - 基础版 (`ImageCanvas`)
   - [ ] 使用 QGraphicsView 加载图片
   - [ ] 实现缩放功能 (Ctrl++/-)
   - [ ] 实现平移功能 (拖拽)
   - [ ] 显示坐标和图片信息
   - **预计时间**：3 天

4. **导入对话框** (`ImportDialog`)
   - [ ] 选择导入源 (文件夹/单图/视频)
   - [ ] 预览导入内容
   - [ ] 执行导入并更新 UI
   - **预计时间**：2 天

5. **集成与测试**
   - [ ] 单元测试 (DataManager)
   - [ ] 集成测试 (UI + DataManager)
   - [ ] 处理错误和边界情况
   - **预计时间**：2 天

---

### Phase 3：标注工具 - 基础版 (第 5-6 周)

#### 任务清单

1. **撤销/重做系统** (`AnnotationManager`)
   - [ ] 实现操作历史堆栈
   - [ ] 实现 undo/redo 逻辑
   - [ ] 绑定快捷键 (Ctrl+Z/Y)
   - **预计时间**：2 天

2. **笔刷和橡皮工具**
   - [ ] 在 `ImageCanvas` 中实现笔刷绘制
   - [ ] 实现鼠标按压/移动/释放逻辑
   - [ ] 调整笔刷大小和颜色
   - [ ] 显示笔刷预览
   - **预计时间**：3 天

3. **多边形绘制工具**
   - [ ] 实现点击添加顶点
   - [ ] 实现右键完成绘制
   - [ ] 实现闭合多边形
   - [ ] 支持撤销单个顶点
   - **预计时间**：2-3 天

4. **Mask 保存与加载**
   - [ ] 实现 Mask 保存为 PNG/numpy
   - [ ] 实现 Mask 加载和显示
   - [ ] 实现 Mask 叠加显示 (透明度可调)
   - **预计时间**：2 天

5. **标注工具栏** (`AnnotationToolbar`)
   - [ ] 创建工具按钮 (笔刷/橡皮/多边形/撤销/重做)
   - [ ] 创建参数调整框 (笔刷大小/透明度)
   - [ ] 绑定信号槽
   - **预计时间**：2 天

6. **测试与优化**
   - [ ] 单元测试
   - [ ] 性能测试 (大图片绘制)
   - [ ] 用户体验改进
   - **预计时间**：2 天

---

### Phase 4：SAM 集成 (第 7-8 周)

#### 任务清单

1. **SAM 模型加载和初始化** (`SAMHandler`)
   - [ ] 下载 SAM 模型权重
   - [ ] 实现模型加载逻辑
   - [ ] 配置 GPU/CPU 推理
   - [ ] 实现模型卸载（释放显存）
   - **预计时间**：2 天

2. **交互式提示输入**
   - [ ] 实现点击收集点提示
   - [ ] 实现绘制框提示
   - [ ] 支持前景/背景点区分
   - [ ] 显示提示预览
   - **预计时间**：2 天

3. **SAM 推理和结果处理**
   - [ ] 实现 `predict_with_points()`
   - [ ] 实现 `predict_with_bbox()`
   - [ ] 实现 mask 后处理 (腐蚀膨胀去噪)
   - [ ] 实现多 mask 选择（置信度排序）
   - **预计时间**：3 天

4. **异步推理线程** (`SAMInferenceThread`)
   - [ ] 实现 QThread 子类
   - [ ] 绑定进度信号
   - [ ] 处理线程错误和取消
   - [ ] 显示推理进度条
   - **预计时间**：2 days

5. **UI 集成**
   - [ ] 在工具栏添加 SAM 按钮
   - [ ] 实现 SAM 提示输入 UI
   - [ ] 显示推理结果
   - [ ] 实现人工修正流程
   - **预计时间**：2 days

6. **测试与优化**
   - [ ] 测试不同提示类型
   - [ ] 性能优化 (显存管理)
   - [ ] 测试边界情况 (无有效提示等)
   - **预计时间**：2 days

---

### Phase 5：标注数据管理 (第 9 周)

#### 任务清单

1. **COCO 格式导出** (`AnnotationManager.export_coco_json()`)
   - [ ] 实现 COCO JSON 生成
   - [ ] 处理 mask → RLE 编码
   - [ ] 生成数据集元数据
   - **预计时间**：2 days

2. **YOLO 格式导出**
   - [ ] 实现 mask → bbox 转换
   - [ ] 生成 YOLO txt 文件
   - [ ] 生成数据集文件列表 (train/val/test)
   - **预计时间**：2 days

3. **VOC/Pascal 格式支持**（可选）
   - [ ] 实现 XML 标注生成
   - **预计时间**：1 day

4. **批量导出与格式转换**
   - [ ] 实现批量导出对话框
   - [ ] 支持多种目标格式
   - [ ] 数据验证与检查
   - **预计时间**：2 days

5. **测试与验证**
   - [ ] 验证导出的 COCO/YOLO 数据有效性
   - [ ] 测试与 PyCocoTools 兼容性
   - **预计时间**：1 day

---

### Phase 6：模型训练模块 (第 10-11 周)

#### 任务清单

1. **模型构建** (`ModelTrainer.build_model()`)
   - [ ] 实现 U-Net
   - [ ] 实现 DeepLabV3+
   - [ ] 集成 YOLOv11-Seg
   - [ ] 支持不同 backbone (ResNet, EfficientNet)
   - **预计时间**：3 days

2. **数据加载和增强**
   - [ ] 实现 SegmentationDataset 类
   - [ ] 配置数据增强管道 (Albumentations)
   - [ ] 实现 DataLoader (train/val split)
   - **预计时间**：2 days

3. **损失函数和评估指标**
   - [ ] 实现 Dice Loss、IoU Loss、BCELoss
   - [ ] 实现组合损失函数
   - [ ] 实现评估指标 (IoU、Dice、Hausdorff 等)
   - **预计时间**：2 days

4. **训练循环** (`ModelTrainer.train()`)
   - [ ] 实现前向传播、反向传播
   - [ ] 实现优化器和学习率调度器
   - [ ] 实现早停机制
   - [ ] 实现模型检查点保存
   - **预计时间**：3 days

5. **异步训练线程** (`TrainingThread`)
   - [ ] 实现 QThread 子类
   - [ ] 实现进度信号和日志输出
   - [ ] 实现训练暂停/恢复/取消
   - **预计时间**：2 days

6. **训练 UI** (`TrainConfigDialog`)
   - [ ] 创建模型选择下拉框
   - [ ] 创建超参数输入框
   - [ ] 实现训练监控面板（损失曲线、指标）
   - [ ] 显示训练时间和 ETA
   - **预计时间**：2 days

7. **测试与调试**
   - [ ] 单元测试（模型构建、数据加载）
   - [ ] 集成测试（完整训练流程）
   - [ ] 性能测试（单 GPU、多 GPU）
   - **预计时间**：2 days

---

### Phase 7：预测和推理模块 (第 12 周)

#### 任务清单

1. **预测器初始化** (`Predictor`)
   - [ ] 实现模型加载
   - [ ] 实现输入预处理
   - [ ] 实现输出后处理
   - **预计时间**：2 days

2. **单图和批量预测**
   - [ ] 实现 `predict()` 方法
   - [ ] 实现 `predict_batch()` 方法
   - [ ] 支持视频逐帧预测
   - **预计时间**：2 days

3. **预测结果后处理**
   - [ ] 实现 mask 二值化
   - [ ] 实现形态学操作 (腐蚀、膨胀)
   - [ ] 实现连通域分析
   - **预计时间**：1 day

4. **异步推理线程** (`InferenceThread`)
   - [ ] 实现 QThread 子类
   - [ ] 实现进度管理
   - **预计时间**：1 day

5. **预测 UI**
   - [ ] 创建预测对话框
   - [ ] 显示预测结果
   - [ ] 支持结果保存
   - **预计时间**：1 day

6. **测试与优化**
   - [ ] 单元测试
   - [ ] 性能基准测试
   - **预计时间**：1 day

---

### Phase 8：可视化和报告 (第 13 周)

#### 任务清单

1. **统计分析** (`Visualizer`)
   - [ ] 实现缺陷数量统计
   - [ ] 实现缺陷面积统计
   - [ ] 实现缺陷分布分析
   - **预计时间**：2 days

2. **图表生成**
   - [ ] 集成 Matplotlib 到 PyQt
   - [ ] 绘制柱状图、饼图、箱线图
   - [ ] 实现交互式图表（可选：Plotly）
   - **预计时间**：2 days

3. **报告导出**
   - [ ] 实现 Excel 报告生成 (openpyxl)
   - [ ] 实现 PDF 报告生成 (reportlab)
   - [ ] 包含图表、统计、数据表格
   - **预计时间**：2 days

4. **测试与调试**
   - [ ] 测试数据统计正确性
   - [ ] 测试报告生成
   - **预计时间**：1 day

---

### Phase 9：集成与测试 (第 14 周)

#### 任务清单

1. **整体集成**
   - [ ] 验证所有模块间交互
   - [ ] 测试完整工作流
   - [ ] 修复集成 bug
   - **预计时间**：2 days

2. **性能测试**
   - [ ] 测试大数据集加载
   - [ ] 测试 SAM 推理速度
   - [ ] 测试训练吞吐量
   - [ ] 内存使用分析
   - **预计时间**：2 days

3. **用户测试和反馈**
   - [ ] 准备测试场景
   - [ ] 收集用户反馈
   - [ ] 修复 UI 问题
   - **预计时间**：2 days

4. **优化和调整**
   - [ ] 性能优化
   - [ ] UI 改进
   - **预计时间**：2 days

---

### Phase 10：文档和部署 (第 15-16 周)

#### 任务清单

1. **文档编写**
   - [ ] 用户指南
   - [ ] API 参考
   - [ ] 安装和配置指南
   - [ ] 故障排除指南
   - **预计时间**：3 days

2. **代码文档**
   - [ ] Docstring 完善
   - [ ] 注释补充
   - **预计时间**：2 days

3. **打包与部署**
   - [ ] 创建 PyInstaller 配置
   - [ ] 生成可执行文件
   - [ ] 准备发布包
   - **预计时间**：2 days

4. **发布前检查**
   - [ ] 最终测试
   - [ ] 版本号和发布说明
   - [ ] 发布到 GitHub/PyPI
   - **预计时间**：2 days

---

## 3. 里程碑时间表

| 里程碑 | 时间 | 交付物 |
|-------|------|--------|
| M1: 框架搭建完成 | 第 2 周 | 可运行的空白应用 |
| M2: 数据管理模块完成 | 第 4 周 | 可加载和浏览图片 |
| M3: 基础标注完成 | 第 6 周 | 可进行手工标注 |
| M4: SAM 集成完成 | 第 8 周 | 自动标注功能可用 |
| M5: 数据导出完成 | 第 9 周 | 支持 COCO/YOLO 导出 |
| M6: 模型训练完成 | 第 11 周 | 可训练多种分割模型 |
| M7: 预测推理完成 | 第 12 周 | 可进行模型预测 |
| M8: 可视化完成 | 第 13 周 | 支持报告生成 |
| M9: 全功能集成 | 第 14 周 | 完整系统可用 |
| M10: 发布就绪 | 第 16 周 | 正式版发布 |

---

## 4. 资源分配

### 4.1 开发团队

- **主开发**：1-2 人 (全栈)
- **UI/前端**：1 人 (如果分工)
- **模型训练**：1 人 (如果分工)
- **测试**：1 人 (后期加入)
- **文档**：1 人 (后期)

### 4.2 硬件要求

- **开发机**：GPU (RTX 3070+), 16GB+ RAM
- **测试机**：多种配置 (CPU only, 不同 GPU)

---

## 5. 风险管理

| 风险 | 概率 | 影响 | 缓解策略 |
|------|------|------|---------|
| SAM 推理性能不佳 | 中 | 高 | 提前测试、考虑模型蒸馏 |
| GPU 显存不足 | 中 | 高 | 实现显存管理、梯度检查点 |
| 数据增强管道复杂 | 低 | 中 | 使用 Albumentations 库简化 |
| 多 GPU 并行困难 | 低 | 中 | 提前学习分布式训练 |
| UI 响应时间长 | 中 | 中 | 充分使用多线程、异步处理 |

---

## 6. 检查清单

- [ ] 所有功能按时完成
- [ ] 代码覆盖率 > 70%
- [ ] 无致命 bug
- [ ] 文档完整
- [ ] 用户可以独立使用系统
- [ ] 性能指标达成
- [ ] 可以打包为可执行文件
